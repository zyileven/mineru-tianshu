# 更新日志

本项目的所有重要变更都将记录在此文件中。

## [0.1.1] - 2026-01-19

### 变更
- **参数命名统一**：将 `force_mineru` 参数重命名为 `convert_office_to_pdf` 以匹配最新的 MinerU-tianshu API 规范
  - 更准确地反映了参数的功能：将 Office 文件转换为 PDF 以获得更好的图片提取效果
  - 同时更新了所有工具（同步和异步版本）
- **语言默认值更新**：将 `lang` 参数的默认值从 `"ch"` 改为 `"auto"`，以便自动检测文档语言
  - 添加了 `"auto"` 选项到语言选择列表
  - 提高了多语言文档处理的便利性

### 向后兼容性
- ✅ 现有工作流程可以继续使用，参数名称的变更会自动处理
- ✅ 所有参数保持可选，具有安全的默认值

---

## [0.1.0] - 2026-01-07

### 新增

#### 认证与安全
- **API 密钥认证**：正确的 `X-API-Key` 请求头格式支持（替换了不正确的 `Authorization: Bearer` 格式）
- **SSL 验证控制**：添加了 `verify_ssl` 提供商级别配置参数（默认：`true`）
  - 用户现在可以在开发环境中禁用 SSL 验证以使用自签名证书
  - 禁用 SSL 验证时会提供安全警告
- **凭证验证**：实现了包含健康检查的综合凭证验证
  - 在插件配置期间测试 API 服务器连接
  - 为 SSL、连接和认证问题提供清晰的错误消息

#### 多引擎支持
- **PaddleOCR-VL 引擎**：支持 109+ 种语言的 OCR，包含文档方向校正
- **SenseVoice 引擎**：带说话人分离和情感检测的语音识别
- **视频处理引擎**：带关键帧 OCR 提取的视频转写
- **引擎特定参数**：
  - `enable_keyframe_ocr`：对视频关键帧启用 OCR（仅限视频后端）
  - `keep_audio`：保留提取的音频文件（仅限视频后端）
  - `enable_speaker_diarization`：启用说话人分离（sensevoice/视频后端）

#### 大型 PDF 处理
- **父子任务支持**：自动检测和跟踪大型 PDF 的处理进度
  - 显示分部分进度和百分比
  - 显示各个子任务状态（待处理/处理中/已完成/失败）
  - 提供合并完成通知
- **增强的进度显示**：在同步和异步模式下实时更新多部分文档处理进度

### 变更
- **认证请求头**：从 `Authorization: Bearer {api_key}` 更改为 `X-API-Key: {api_key}`（符合 MinerU-tianshu API 规范）
- **SSL 处理**：移除了硬编码的 `verify=False` 和 `urllib3.disable_warnings()` 调用
  - SSL 验证现在遵循用户配置
  - 默认更加安全
- **后端选项标签**：更新为包含描述性信息（例如"Pipeline (MinerU - 推荐)"、"PaddleOCR-VL (109+ 种语言 OCR)"）

### 修复
- **文件访问方法**：通过备用机制改进了文件内容检索
  - 主要方式：基于 URL 的下载，支持 SSL 控制
  - 备用方式：直接 blob 访问
  - 为 SSL 和 FILES_URL 配置问题提供更好的错误消息

### 安全
- **默认 SSL 验证**：现在默认启用 SSL 证书验证
- **安全配置**：禁用 SSL 验证时提供明确的警告
- **API 密钥保护**：提供商配置中 API 密钥字段使用正确的 secret-input 类型

### 向后兼容性
- ✅ 所有现有工作流程无需修改即可继续工作
- ✅ `api_key` 保持可选（支持认证和非认证模式）
- ✅ 新的引擎参数为可选，具有安全的默认值
- ✅ 父任务字段为可选（优雅地处理单任务响应）
- ✅ 无需数据迁移

---

## [0.0.1] - 2025-12-01

### 初始版本
- 基于 MinerU Pipeline 后端的基本文档解析
- 支持 VLM Transformers 和 vLLM 引擎
- 同步和异步解析模式
- 公式和表格识别
- 多语言支持（中文、英文、韩文、日文）
